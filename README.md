# CSA-CPAP-Prescribing

> Supporting code for the manuscript **“Predictors of Initial CPAP Prescription and Subsequent Course with CPAP in Patients with Central Sleep Apneas at a Single Center”** (Lung, 2023-11-21).

**Links & IDs**
- Paper (Version of Record): DOI [10.1007/s00408-023-00657-z](https://doi.org/10.1007/s00408-023-00657-z) · Lung · 2023-11-21
- Open-access manuscript: PMCID [PMC10869204](https://pmc.ncbi.nlm.nih.gov/articles/PMC10869204/), PMID [37987861](https://pubmed.ncbi.nlm.nih.gov/37987861/)
- Repository: https://github.com/reblocke/CSA-CPAP-Prescribing
- Code availability statement in paper links to this repo.
- Suggested archival practice: create a tagged release of this repository and archive it to Zenodo to mint a release DOI; record the tag and DOI here for long-term reproducibility.

## Cite this work
Please cite the **article** as the primary scholarly object and this repository as the **software** artifact. A machine-readable citation file (`CITATION.cff`) is provided.

**Preferred article citation**  
Locke BW, Sellman J, McFarland J, Uribe F, Workman K, Sundar KM. Predictors of Initial CPAP Prescription and Subsequent Course with CPAP in Patients with Central Sleep Apneas at a Single Center. Lung. 2023;201(6):625–634. doi:10.1007/s00408-023-00657-z.

## Quick start (recreate main regression outputs)
These instructions reflect the analysis environment reported in the paper.

1. **Software**
   - Stata 17 or newer.
2. **Stata packages (first run only)**
   ```stata
   ssc install coefplot, replace
   ssc install outreg2, replace
   ```
3. **Run the analysis do-file**
   - Open Stata, set the working directory to the repository root, and run:
     ```stata
     do "Stata/CSA regressions.do"
     ```
   - The script fits logistic models and writes regression tables/figures to the `Results/` and `Figures/` folders.

> **Note:** Figures 1–3 in the paper are cohort/outcome flow diagrams; Figure 4 is produced from multivariable logistic models (odds ratios) and is generated by the Stata code.

## Data access
This study used **electronic health record (EHR) data from a single academic medical center** under IRB approval (University of Utah IRB #00123537). **Raw patient-level data are not publicly shared**. To reuse the code on your own data:
- Provide variables with the following semantics used in the models (non-exhaustive):  
  `age`, `female`, `bmi`, `smoking` (categorical), `elevation` (home ZIP elevation), `ahi` (events/hr), `hsat` (diagnostic modality), etiology indicators such as `has_cns` (neurologic), `has_cv` (cardiac), `has_opiate`, `has_primary`, `has_tecsa`, `has_osacsa`, and a central‑apnea proportion category variable like `perc_osa_ord`. Example outcomes include `outcome_noncompliant` (nonadherence) and indicators of initial CPAP trial and adequate response.
- If you cannot access comparable EHR data, you may adapt the code to a **synthetic** or **de‑identified** dataset with the same variable names.

## Environment
- **Language / tool:** Stata 17 (College Station, TX) as reported in the manuscript.
- **OS / hardware:** Any OS supported by Stata; no special hardware required.
- **Randomness:** Logistic models are deterministic given the same inputs; no stochastic seeding is required.

## Repository layout
```
├── Stata/                  # Primary analysis do-file(s), e.g., "CSA regressions.do"
├── Results/                # Model outputs/tables (e.g., Word/Excel)
└── Figures/                # Exported figures from coefplot/graphs and any schematic flow charts
```

## Workflow
High level:
1. Prepare analytic dataset (EHR-derived; not included here).
2. Run `Stata/CSA regressions.do` to fit logistic models for:
   - (a) initial CPAP prescription (yes/no), and
   - (b) adequate response to CPAP among those trialed.
3. Export regression tables and coefficient plots (odds ratios).

## Results mapping (paper ↔ code)
| Paper item | Where generated | Command | Output |
|---|---|---|---|
| **Figure 4**: Multivariable logistic ORs for initial CPAP and adequate response | `Stata/CSA regressions.do` using `coefplot` | `do "Stata/CSA regressions.do"` | Saved under `Figures/` (file name set in the do‑file) |
| **Tables (regression summaries)** | `Stata/CSA regressions.do` using `outreg2` | same as above | Word/Excel files in `Results/` (e.g., `logistic_results.docx`, `cpap compliant table1.xlsx`) |
| **Figures 1–3**: flow diagrams | Not programmatically generated (schematics) | n/a | Provided under `Figures/` |

## Quality checks
- Run a “smoke test” by executing only the model section(s) on a **small sample** of your data to ensure variable names and encodings match expected formats.
- See `CONTRIBUTING.md` for guidance on adding tests or minimal example data.

## License
A permissive **MIT License** is provided (see `LICENSE`). If your institution requires a different license, please update the file and the notice in this README.

## Funding & acknowledgements
This work was supported by the **National Institutes of Health** under Ruth L. Kirschstein National Research Service Award **5T32HL105321** (B.W.L.). B.W.L. also receives funding for an unrelated project from an American Thoracic Society program supported by **ResMed**, **Philips Respironics**, and **Fisher & Paykel Healthcare**. K.M. Sundar is co‑founder of Hypnoscure LLC through the University of Utah Technology Commercialization Office and is an associate editor at *Lung*.

## Contributing, conduct, and security
- Please see `CONTRIBUTING.md` and `CODE_OF_CONDUCT.md` for how to propose changes.
- Security/disclosure: see `SECURITY.md`.

## Maintainers / contact
Open an issue in this repository for questions about the code. For scientific questions about the study, please contact the corresponding author listed in the manuscript.
